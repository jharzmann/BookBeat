<script src="http://connect.soundcloud.com/sdk.js"></script>
<script>
SC.initialize({
  client_id: 'e5827bb602f60810667a81ca65823de3'
});
</script>

<p id="notice"><%= notice %></p>

<h1>Listing songs</h1>

<p>
  <b>BookID:</b>
  <%= @catalog.book_id %>
</p>

<p class="book-stuff">
</p>
<script>
$(document).ready(function(){
  $.getJSON('https://api.readmill.com/v2/books/'+ "<%= @catalog.book_id %>"
  +'.json?client_id=3c3e949307f81c6445f04491b5843609&callback=?', function(data) {
    console.log(data);
    $(".book-stuff").html("Author: " + data.book.author + "<br>"
    + "Title: " + data.book.title + "<br>"
    + "Picture: " + data.book.cover_url);
  });
});
</script>

<% i = 0 %>

<% Catalog.getAllSongIdsFor(@catalog.book_id) .each do |song| %>
  <% puts "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX NEW SONG!" %>
  <% new_div_id = "putTheWidgetHere" + i.to_s %>
  <b>Song:</b> <%= link_to song[0], song[1] %>
  <div id="<%= new_div_id %>"></div>
  <br/ >
  <script type="text/JavaScript">
    SC.oEmbed('<%= song[1] %>', {color: "ff0066"},
    document.getElementById("<%= new_div_id %>"));
  </script>
  <% i += 1 %>
<% end %>

